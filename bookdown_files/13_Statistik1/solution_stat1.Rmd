---
output:
  pdf_document: default
  html_document: default
---
##  Loesung Aufgabe 1.1

*****

>Download [R-Skript](13_Statistik1/RFiles/solution_stat1.R)

>Download [PDF](13_Statistik1/RFiles/solution_stat1.pdf)

*****


**kommentierte Musterlösungen**
```{r, message=T, purl = F, include=FALSE}
## ladet die nötigen Packete und die novanimal.csv Datei in R

library(tidyverse)
library(data.table)
library(here)
library(lubridate)

# lade Daten vom Feldexperiment: Kassendaten
# für Informationen zu den einzelnen Variablen, siehe 
nova <- read_delim("13_Statistik1/data/2017_ZHAW_aggregated_menu_sales_NOVANIMAL.csv", delim = ";")


# lade Daten von der Gästebefragung 2017
# für Informationen zu den einzelnen Variablen, siehe https://zenodo.org/record/3554884/files/2020_ZHAW_vonRickenbach_Variablen_cleaned_recoded_survey_dataset_anonym_NOVANIMAL.pdf?download=1
nova_survey <- data.table::fread("https://zenodo.org/record/3554884/files/2019_ZHAW_vonRickenbach_cleaned_recorded_survey_dataset_NOVANIMAL_anonym.csv?download=1", sep = ";", encoding = "Latin-1") %>% 
  mutate(date = as_date(date)) %>% 
  as_tibble()

#überprüfe die Datenstruktur
glimpse(nova_survey)

## definiert mytheme für ggplot2 (verwendet dabei theme_classic())

mytheme <- 
  theme_classic() + 
  theme(
    axis.line = element_line(color = "black"), 
    axis.text = element_text(size = 12, color = "black"), 
    axis.title = element_text(size = 12, color = "black"), 
    axis.ticks = element_line(size = .75, color = "black"), 
    axis.ticks.length = unit(.5, "cm")
    )

```



```{r}
# Als eine Möglichkeit, die Aufgabe 1.1 zu bearbeiten, nehmen wir hier den 
# Datensatz  der Gästebefragung NOVANIMAL und gehen der folgenden Frage nach: 
# Gibt es einen Zusammenhang zwischen Geschlecht und dem wahrgenommenen 
# Milchkonsum (viel vs. wenig Milch/-produkte)

# die Variable wahrgenommener Milchkonsum muss noch in 2 Kategorien zusammengefasst werden: geringer vs. hoher Milchkonsum


# Variable  milk == wahrgenommener Milchkonsum 
# alles kleiner als 4 (3 inklusive) == geringer wahrgenommener Milchkonsum, 
#alles grösser als 3 (4 inklusive) == hoher wahrgenommener Milchkonsum
nova2 <- nova_survey %>% 
  filter(gender != "x") %>% # x aus der Variable Geschlecht entfernen 
  mutate(milkcompt = if_else(milk >= 3, "wenig", "viel")) %>% 
  select(gender, milkcompt) %>% 
  drop_na() # alle Missings können gestrichen werden
 
    
# mal anschauen
table(nova2)


#Chi-squared Test
chi_sq <- chisq.test(nova2$gender, nova2$milkcompt)
chi_sq

#Fisher's Test 
fisher.test(nova2$gender, nova2$milkcompt)
```

*****


**Ergebnisse**

Der $\chi^2$-Test sagt uns, dass das Geschlecht und der wahrgenommene Milchkonsum nicht zusammenhängen. Es gibt keine signifikante Unterscheide zwischen dem Geschlecht und dem wahrgenommenen Milchkonsum ($\chi^2$(`r chi_sq$parameter`) = `r round(chi_sq$statistic[[1]], digits = 3)`, *p* = `r round(chi_sq$p.value[[1]], digits = 3)`. Es sieht so aus, dass Männer leicht mehr angeben weniger Milch zu konsumieren (Tabelle 1). Die Ergebnisse müssen jedoch mit Vorsicht interpretiert werden, denn der $\chi^2$-Test gibt uns nur an, dass ein signifikanter Unterschied zwischen Geschlecht und wahrgenommener Milchkonsum vorliegt. Um die Unterschiede innerhalb der Gruppen (z.B. Geschlecht) festzustellen bedarf es weiterer Analysen z. B. Odds Rations oder einer mehrfaktorieller ANOVA mit anschliessenden Post-hoc Tests (siehe Statistik 3).

```{r, echo=F}
table <- nova2 %>%
  group_by(gender, milkcompt) %>% 
  summarise(tot = n()) %>% 
  mutate(`wahr. Milchkonsum (%)` = round(tot / sum(tot) * 100, 1)) %>% 
  rename(Geschlecht = gender, `wahr. Milchkonsum` = milkcompt, `absolute Werte`= tot)

knitr::kable(table, caption = "Wahrgenommener Milchkonsum nach Geschlecht")

```




###  Musterloesung Aufgabe 1.2: t-Test
> Meine Empfehlung Kapitel 2 von [Manny Gimond](https://mgimond.github.io/Stats-in-R/z_t_tests.html) 

**Null- und Alternativhypothese**
$H_0$: Es gibt keine Unterschiede in den Verkaufszahlen zwischen Basis- und Interventionswochen. 
\par
$H_1$: Es gibt Unterschiede in den Verkaufszahlen zwischen Basis- und Interventionswochen.


```{r}
# Gemäss Aufgabenstellung müsset die Daten zuerst nach Kalenderwochen "week" 
# und Bedingungen "condition" zusammengefasst werden

df <- nova %>%
    group_by(week, condit) %>%  
    summarise(tot_sold = n()) 

# überprüft die Voraussetzungen für einen t-Test
ggplot(df, aes(x = condit, y= tot_sold)) + # achtung 0 Punkt fehlt
    geom_boxplot(fill = "white", color = "black", size = 1) + 
    labs(x="\nBedingungen", y="Durchschnittlich verkaufte Gerichte pro Woche\n") + 
    mytheme

# Auf den ersten Blick scheint es keine starken Abweichungen zu einer 
#Normalverteilung zu geben resp. es sind keine extremen schiefen Verteilungen
# ersichtlich (vgl. Skript Statistik 2)

```


```{r}

# führt einen t-Tests durch; 
# es wird angenommen, dass die Verkaufszahlen zwischen den Bedingungen 
# unabhängig sind

t_test <- t.test(tot_sold ~ condit, data=df, var.equl = T)

#alternative Formulierung
t.test(df[df$condit == "Basis", ]$tot_sold, 
                 df[df$condit == "Intervention", ]$tot_sold) 

```

******

**Methoden**

Ziel war es die aggregierten Verkaufszahlen zwischen den Interventions- und Basiswochen zu vergleichen. Die Annahme war, dass die wöchentlichen Verkaufszahlen unabhängig sind. Daher können die mittleren Verkaufszahlen pro Woche zwischen den beiden Bedingungen mittels t-Test geprüft werden. Obwohl die visuelle Inspektion keine schwerwiegenden Verletzungen der Modelvoraussetzung zeigte, wurde einen Welch t-Test gerechnet. 


******

**Ergebnisse**

In den Basiswochen werden mehr Gerichte pro Woche verkauft als in den Interventionsowochen (siehe Abbildung 1). Die wöchentlichen Verkaufszahlen zwischen den Bedigungen (Basis oder Intervention) unterscheiden sich gemäss Welch t-Test jedoch nicht signifikant (*t*(`r round(t_test$parameter[[1]],digits = 0)`) = `r round(t_test$statistic, digits = 3)` , *p* = `r round(t_test$p.value, digits=3)`).


```{r, purl=F, message=T, echo = F,  fig.cap="Die wöchentlichen Verkaufszahlen für die Interventions- und Basiswochen unterscheiden sich nicht signifikant.", out.width = "80%"}
# zeigt die Ergebnisse mit einer Abbildung
ggplot(df, aes(x = condit, y= tot_sold)) + 
  # erzeugt sogenannte Whiskers mit Strichen, achtung reihenfloge zählt hier
  stat_boxplot(geom ='errorbar', width = .25) + 
  geom_boxplot(fill = "white", color = "black", size = 1) +
  labs(x="\nBedingungen", y="Durchschnittlich verkaufte Gerichte pro Woche\n") + 
  mytheme

```

