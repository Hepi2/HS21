---
title: "Modul Research Methods HS19"
output:
  html_document:
    df_print: paged
---


###  Musterlösung Aufgabe 1.2: $\chi^2$-Test
## Meine Empfhelung Kapitel 4 von [Manny Gimond](https://mgimond.github.io/Stats-in-R/ChiSquare_test.html)

```{r setup, include=FALSE, purl = F, message=F}
knitr::opts_chunk$set(fig.width = 20, fig.height = 12, warning = F, message = F, error = F, include = T, fig.pos = 'H')

```


```{r, message=T, purl = F, include=FALSE}
## ladet die nötigen Packete und die novanimal.csv Datei in R

library(tidyverse)
nova <- read_delim("13_Statistik1/data/novanimal.csv", delim = ";")

## definiert mytheme für ggplot2 (verwendet dabei theme_classic())

mytheme <- 
  theme_classic() + 
  theme(
    axis.line = element_line(color = "black"), 
    axis.text = element_text(size = 20, color = "black"), 
    axis.title = element_text(size = 20, color = "black"), 
    axis.ticks = element_line(size = 1, color = "black"), 
    axis.ticks.length = unit(.5, "cm")
    )

```

# Null- und Alternativhypothese
## Beachtet: ungerichtet vs. gerichtete Hypothesen (z.B. Statistik 1, Folie 24)
## überblick zu Hypothesentestung dazu: https://www.youtube.com/watch?v=F4c0EjsDvzo 
 

$H_0$: Es gibt keine Unterschiede zwischen der Population und der Stichprobe bezüglich Geschlecht und Hochschulzugehörigkeit. 
\par
$H_1$: Es gibt Unterschiede zwischen der Population und der Stichprobe bezüglich Geschlecht und Hochschulzugehörigkeit.

```{r}
# bereitet eure Daten auf
# gruppiert die Varieblen und fasst sie 
# nach Geschlecht und Hochschulzugehörigkeit zusammen 
# fügt Information aus der Aufgabenstellung hinzu: absolute Häufigkeiten der Gesamtheit

df_t <- group_by(nova, gender, member) %>% 
  summarise(stichprobe = n()) %>% 
  ungroup() %>%
  mutate(canteen_member = c("Mitarbeiterinnen", "Studentinnen", "Mitarbeiter", "Studenten"),
         gesamtheit = c(345, 719, 339, 816), # Achtung: reihenfolge muss stimmten vgl. canteen_member
         gesamtheit_pct = gesamtheit / sum(gesamtheit),
         stichprobe_pct = stichprobe / sum(stichprobe)) 

# berechnet den Chi-Quadrat-Test
## Meine Empfehlung Kapitel 4 von Manny Gimond https://mgimond.github.io/Stats-in-R/index.html

chi_sq <- chisq.test(df_t[ ,c("stichprobe", "gesamtheit")], ) # beachtet dabei wie ihr die Variablen resp. die Zahlen dem chisq.test übergibt (siehe Statistik 1, Folie 33, oder lest die Details von der Help-Funktion)

chi_sq


# Alternativer Lösungsweg
observed <- group_by(nova, gender, member) %>% 
  summarise(tot = n())
observed

expected <- c(0.15,0.32,0.16,0.37) # definiert einen Vektor mit den erwarteten Wahrscheinlichkeiten, beachtet dabei die Reihenfolge 

chi_sq <- chisq.test(observed$tot, p = expected)
chi_sq
```

#### Methodenteil

Ziel war es die novanimal Stichprobe in der Gesamtpopulation bezüglich Geschlecht und Hochschulzugehörigkeit besser einzuordnen. Die Gesamtpopulation definiert sich durch alle aktiven CampusCards. Da die untersuchten Variablen Kategorien sind, wurde einen $\chi^2$ resp. einen Fishers exakten Test gerechnet. 

#### Ergebnisteil

Der $\chi^2$-Test sagt uns, dass die NOVANIMAL-Stichprobe von der Population signifikant unterscheidet ($\chi^2$(`r chi_sq$parameter`) = `r round(chi_sq$statistic[[1]], digits = 3)`, *p* > .001). Auch der Fishers exakte Test zeigt einen ähnlichen p-Wert (*p* > .001). Demnach ist unsere Stichprobe bezüglich den Variablen Geschlecht und Hochschulzugehörigkeit nicht repräsentativ für die Grundgesamtheit. Es scheint, dass die Studentinnen unter- und die Studenten übervertreten sind (siehe Table 1).

```{r, echo=F, fig.}
table <- df_t %>% 
  rename(Hochschulzugehörigkeit = member, `Anzahl Population` = gesamtheit, `Anzahl Stichprobe` = stichprobe, `Anteil Population (%)` = gesamtheit_pct, `Anteil Stichprobe (%)` = stichprobe_pct) %>%
  dplyr::select(Hochschulzugehörigkeit, `Anzahl Population`, `Anteil Population (%)`, `Anzahl Stichprobe`, `Anteil Stichprobe (%)`) %>% 
  mutate(`Anteil Stichprobe (%)` = round(`Anteil Stichprobe (%)`,2)*100, `Anteil Population (%)` = `Anteil Population (%)`*100)
knitr::kable(table, caption = "Anzahl und Anteil Beobachtungen in der Population und in der Stichprobe")

```


###  Musterlösung Aufgabe 1.3: t-Test
> Meine Empfehlung Kapitel 2 von [Manny Gimond](https://mgimond.github.io/Stats-in-R/z_t_tests.html) 

## Null- und Alternativhypothese
$H_0$: Es gibt keine Unterschiede in den Verkaufszahlen zwischen Basis- und Interventionswochen. 
\par
$H_1$: Es gibt Unterschiede in den Verkaufszahlen zwischen Basis- und Interventionswochen.


```{r}
# Gemäss Aufgabenstellung müsset die Daten zuerst nach Kalenderwochen "week" und Bedingungen "condition" zusammengefasst werden

df <- nova %>%
    group_by(week, condit) %>%  
    summarise(tot_sold = n()) 

# überprüft die Voraussetzungen für einen t-Test
ggplot(df, aes(x = condit, y= tot_sold)) + # achtung 0 Punkt fehlt
    geom_boxplot(fill = "white", color = "black", size = 1) + 
    labs(x="\nBedingungen", y="Durchschnittlich verkaufte Gerichte pro Woche\n") + 
    mytheme
    
#boxplot mit base R
par(mar=c(5.1,5.5,4.1,2.1)) #Anpassen der Seitenränder (default: mar=c(5.1,4.1,4.1,2.1))
boxplot(tot_sold~condit, df,boxwex = 0.4, col = "lightgrey",ylab="Durchschnittlich verkaufte Gerichte pro Woche",xlab="Bedingungen", cex.axis=1.5 ,cex.lab=1.5)

# Auf den ersten Blick scheint es keine starken Abweichungen zu einer Normalverteilung zu geben resp. es sind keine extremen schiefen Verteilungen ersichtlich (vgl. Statistik 2, Folien 12-21)

```


```{r}

# führt einen t-Tests durch; 
# es wird angenommen, dass die Verkaufszahlen zwischen den Bedingungen unabhängig sind

t_test <- t.test(tot_sold~condit, data=df)

t.test(df[df$condit == "Basis", ]$tot_sold, 
                 df[df$condit == "Intervention", ]$tot_sold) #alternative Formulierung

```

#### Methodenteil

Ziel war es die wöchentlichen Verkaufszahlen zwischen den Interventions- und Basiswochen zu vergleichen. Die Annahme war, dass die wöchentlichen Verkaufszahlen unabhängig sind. Daher können die mittleren Verkaufszahlen pro Woche zwischen den beiden Bedingungen mittels t-Test geprüft werden. Obwohl die visuelle Inspektion keine schwerwiegenden Verletzungen der Modelvoraussetzung zeigte, wurde einen Welch t-Test gerechnet. 

#### Ergebnisteil

In den Basiswochen werden mehr Gerichte pro Woche verkauft als in den Interventionsowochen (siehe Figure 1). Die wöchentlichen Verkaufszahlen zwischen den Bedigungen (Basis oder Intervention) unterscheiden sich gemäss Welch t-Test jedoch nicht signifikant (*t*(`r round(t_test$parameter[[1]],digits = 0)`) = `r round(t_test$statistic, digits = 3)` , *p* = `r round(t_test$p.value, digits=3)`).


```{r, purl=F, message=F, echo = F,  fig.cap="Die wöchentlichen Verkaufszahlen für die Interventions- und Basiswochen unterscheiden sich nicht signifikant."}
# zeigt die Ergebnisse mit einer Abbildung
ggplot(df, aes(x = condit, y= tot_sold)) + 
  stat_boxplot(geom ='errorbar', width = .25) + # erzeugt sogenannte Whiskers mit Strichen
  geom_boxplot(fill = "white", color = "black", size = 1) +
  labs(x="\nBedingungen", y="Durchschnittlich verkaufte Gerichte pro Woche\n") + 
  mytheme

```


*******
##### letztes Update `r Sys.Date()`, gian-andrea.egeler@zhaw.ch
##### stefan.widmer@zhaw.ch
