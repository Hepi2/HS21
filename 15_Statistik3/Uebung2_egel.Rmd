---
title: "Übungen Statistik"
author: "Gian-Andrea Egeler"
date: "19 9 2018"
output: html_document
---

### Aufgabe 4: multiple Regression


Führt mit dem Datensatz novanimal.csv eine Regression durch (Aufbereitung der Daten, visuelle Inspektion der Modellvoraussetzung, Berechnung des Modells, Darstellung und Interpretation der Ergebnisse). 

**Ermitteln Sie ein minimal adäquates Modell, haben die sozioökonomischen Variablen einen Einfluss auf die Verkaufszahlen.**



### Musterlösung Aufgabe 4

```{r, message=FALSE, echo=FALSE, results='hide', warning=FALSE}

library(readr)
library(dplyr)
library(car)
library(gmodels)
library(ggfortify)

nova <- read_delim("/home/egel/Unterrichtsunterlagen_HS18/15_Statistik3/data/novanimal_time.csv", delim = ";")

```


```{r}
#Explorative Datenanalyse der abhängigen Variablen

df <- nova_tot # kopiere originaler Datensatz
df$label_content[grep("Pflanzlich+",df$label_content)] <- "Vegetarisch" # Fasse die Menü-Inhalte zusammen


df_ <- df %>%
  #filter(!is.na(.$tot_ubp)) %>%
  group_by(label_content, gender, member, age, condit) %>%
  summarise(tot_sold = n())

#Explorative Datenanalyse der abhängigen Variablen
ggplot(df_, aes(y = tot_sold)) + geom_boxplot() + theme_apa(x.font.size = 20, y.font.size = 20) +  theme(axis.text = element_text(size = 20)) # keine Normalverteilung gegeben

#Regression
lm1 <- lm(tot_sold ~ tot_ubp + gender + member + label_content, data = df_)
autoplot(lm1)  # Modelgütekriterien sind klar verletzt
summary(lm1)

# alternative Lösungen für nicht parametrische Regression P-splines, k nearest neighbors, loess/loewess, kriging


# Visualisiere Regression mit Regressionslinie
ggplot(df_, aes(x = tot_ubp, y = tot_sold)) + geom_point() + theme_apa(x.font.size = 20, y.font.size = 20) +  theme(axis.text = element_text(size = 20))
#geom_smooth(method = "lm", formula = y~x) 

```


### Aufgabe 5: logit Regression


Führt mit dem Datensatz novanimal.csv eine logistsiche Regression durch (Aufbereitung der Daten, visuelle Inspektion der Modellvoraussetzung, Berechnung des Modells, Darstellung und Interpretation der Ergebnisse). 

**Ermitteln Sie ein minimal adäquates Modell, welche der Fleischkonsum erklärt.**



### Musterlösung Aufgabe 5

```{r}
# Genereiere Dummyvariable Fleisch 1, kein Fleisch 0

df <- nova
df$meat <- ifelse(nova$label_content == "Fleisch", 1, 0)

CrossTable(df$meat, df$gender, chisq = T)
CrossTable(df$meat, df$member, chisq = T)

mod0 <- glm(meat ~ gender + member + shop_description + age + price_article , data = df, binomial)
summary(mod0)
crPlots(mod0)
1 - (mod0$dev / mod0$null)

# sage Fleischessverhalten vorher

model.predict<-predict(mod0,type="response",se=T,newdata=df)
plot(meat~gender,data=df,xlab="Fläche (km²)",ylab="Vorkommenswahrscheinlichkeit",pch=16, col="red")
points(model.predict$fit ~ xs,type="l")
lines(model.predict$fit+model.predict$se.fit ~ xs, type="l",lty=2)
lines(model.predict$fit-model.predict$se.fit ~ xs, type="l",lty=2)

```

