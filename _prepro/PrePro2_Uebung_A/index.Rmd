---
title: Uebung A
output: distill::distill_article
categories:
- PrePro2
author:
  - name: Patrick Laube
  - name: Nils Ratnaweera
  - name: Nikolaos Bakogiannis
draft: true
---

```{r include=FALSE, purl=F}
knitr::opts_chunk$set(echo = TRUE, include = F, collapse=TRUE)
```



```{r,message=F}
library(tidyverse)
library(lubridate)
library(stringr)
```


## Aufgabe 1

Lade die Wetterdaten runter ([weather.csv](weather.csv)) und importiere sie in `R`.

```{r loesung-1}

wetter <- read_csv("weather.csv",
                  col_types = list(
                    col_factor(levels = NULL),    
                    col_datetime(format = "%Y%m%d%H"),
                    col_double()
                    )
                  )
```


## Aufgabe 2

Importiere die Datei [metadata.csv](metadata.csv) (z.B. mit `read_delim`).

Hinweis: Wenn Umlaute und Sonderzeichen nicht korrekt dargestellt werden (z.B. in Gen*è*ve), hat das vermutlich mit der [Zeichencodierung](https://de.wikipedia.org/wiki/Zeichenkodierung) zu tun. Das File ist aktuell in 'ANSI' Codiert, welche für gewisse Betriebssysteme / R-Versionen ein Problem darstellt. Um das Problem zu umgehen muss man das File mit einem Editor öffnen (Windows 'Editor' oder 'Notepad++', Mac: 'TextEdit') und mit einer neuen Codierung (z.B 'UTF-8') abspeichern. Danach kann die Codierung spezifitiert werden (bei `read_delim(): mit `locale = locale(encoding = "UTF-8")`)

```{r loesung-2}


wetter_legende <- read_delim("metadata.csv",
                             delim = ";", 
                             locale = locale(encoding = "UTF-8"))

```


## Aufgabe 3

Die x-/y-Koordinaten sind aktuell in einer Spalte erfasst. Um mit den Koordinaten sinnvoll arbeiten zu können, brauchen wir die Koordinaten getrennt. Trenne die `x` und `y` Koordinaten aus der Spalte `Koordinaten`.

1. Schritt: verwende `stringr::str_split_fixed` um die Spalte in eine `matrix` zu überführen
2. Schritt: benenne die Spalten der `matrix` in `x` und `y` um
3. Schritt: nutze `cbind` um die `matrix` mit der `data.frame` zu verbinden

```{r loesung-3}


# 1. Schritt
koordinaten <- str_split_fixed(wetter_legende$Koordinaten, "/", 2)
# 2. Schritt
colnames(koordinaten) <- c("x","y")
# 3. Schritt
wetter_legende <- cbind(wetter_legende,koordinaten)
```


## Aufgabe 4

Nun wollen wir den Datensatz `wetter`mit den Informationen aus `wetter_legende`anreichern. Uns interessiert aber nur das Stationskürzel, der Name, die x/y Koordinaten sowie die Meereshöhe. Lösche die nicht benötigten Spalten (oder selektiere die benötigten Spalten).

```{r loesung-4, message=F}

wetter_legende <- wetter_legende[,c("stn", "Name", "x","y","Meereshoehe")]
```


## Aufgabe 5

Nun ist der Datensatz `wetter_legende` genügend vorbereitet. Jetzt kann er mit dem Datensatz `wetter` verbunden werden. Überlege dir, welcher Join dafür sinnvoll ist und mit welchem Attribut wir "joinen" können.

Nutze die Join-Möglichkeiten von `dplyr` (Hilfe via `?dplyr::join`)  um die Datensätze `wetter` und `wetter_legende`zu verbinden.

```{r loesung-5}


wetter <- left_join(wetter,wetter_legende,by = "stn")

# Jointyp: Left-Join auf 'wetter', da uns nur die Stationen im Datensatz 'wetter' interessieren.
# Attribut: "stn"
```

## Aufgabe 6

Erstelle eine neue Spalte `month` welche den jeweiligen Monat (aus `time`) beinhaltet. Nutze dafür die Funktion `lubridate::month()`.

```{r loesung-6}
wetter$month <- month(wetter$time)
```

## Aufgabe 7

Berechne mit der Spalte `month` die Durchschnittstemperatur pro Monat.


```{r loesung-7, warning=F}

mean(wetter$tre200h0[wetter$month == 1])
mean(wetter$tre200h0[wetter$month == 2])
mean(wetter$tre200h0[wetter$month == 3])

# usw. für alle 12 Monate
```


