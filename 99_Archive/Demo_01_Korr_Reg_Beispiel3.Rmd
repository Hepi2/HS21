
```{r, include=F, purl = F}
# knitr::opts_knit$set(root.dir = "14_Statistik2") 
```



```{r, message=F}
library(tidyverse)
library(ggfortify) # um autoplot() für lm/aov nutzen zu können


```

#### Beispiel 3: Simple linear regression - fixed X

[Script als Download](14_Statistik2/RFiles/Demo_01_Korr_Reg_Beispiel3.R)


Amerikanischer Reismehlkäfer *Tribolium confusum* aus @logan2010 [S. 188] (Script an Tools/Packages des Moduls Research Methods angepasst)


As part of a Ph.D into the effects of starvation and humidity on water loss in the confused flour beetle (*Tribolium confusum*), Nelson (1964) investigated the linear relationship between humidity and water loss by measuring the amount of water loss (mg) by nine batches of beetles kept at different relative humidities (ranging from 0 to 93%) for a period of six days (Table 14.1 Sokal and Rohlf (1997)).

##### Step 1

Import the Nelson (1964) data set [nelson.csv](14_Statistik2/data/nelson.csv)


```{r, message = F}

nelson <- read_csv("14_Statistik2/data/nelson.csv")

```


##### Step 2

Assess linearity, normality and homogeneity of variance using a scatterplot with marginal boxplots and a lowess smoother.

```{r, fig.cap="Conclusions - no evidence of nonnormality (boxplots not overly asymmetrical), non homogeneity of variance (points do not become progressively more or less spread out along the regression line) or non-linearity [@logan2010]"}

p <- ggplot(nelson, aes(HUMIDITY,WEIGHTLOSS)) +
  geom_point() +
  geom_smooth(se = F)


ggMarginal(p, type = "boxplot",size = 15)
```

##### Step 3

The ordinary least squares method is considered appropriate as the there is effectively no uncertainty (error) in the predictor variable (relative humidity).

##### Step 4 

Fit the simple linear regression model ($y_i = \beta_0 + \beta_1\chi_i$) and examine the diagnostics.



```{r, fig.cap="Conclusions - There is no obvious 'wedge pattern' evident in the residual plot (confirming that the assumption of homogeneity of variance is likely to be met). Although there is some deviation in the QQ normal plot (suggesting that the response variable does deviate from normal), the sample size is rather small and the test is reasonably robust to such deviations. Finally, none of the points approach the high Cook’s D contours suggesting that none of the observations are overly influential on the final fitted model."}

nelson.lm <- lm(WEIGHTLOSS ~HUMIDITY, nelson)


autoplot(nelson.lm, label.size = 3)



```


```{r}
influence.measures(nelson.lm)
```

Conclusions: None of the leverage (hat) values are greater than $2*\frac{p}{n} = 0.444$ and therefore (none are considered to be outliers in x-space). Furthermore, none of the Cook’s D values are $\ge$ 1 (no point is overly influential). Hence there is no evidence that hypothesis tests will be unreliable.





##### Step 5

Examine the parameter estimates and hypothesis tests

```{r}
summary(nelson.lm)
```


Conclusions - Reject H0 that the population slope equals zero. An increase in relative humidity was found to be associated with a strong ($r^2 = 0.975$), significant decrease in weight loss ($b = -0.053$, $t7 = -16.35$, $P < 0.001$) in confused flour beetles.


##### Step 6

Calculate the 95% confidence limits for the regression coefficients


```{r}
confint(nelson.lm)

```



##### Step 7

Use the fitted linear model to predict the mean weight loss of flour beetles expected at 50 and 100% relative humidity

```{r}
predict(nelson.lm, data.frame(HUMIDITY = c(50, 100)), interval="prediction",se=T)
```

##### Step 8

Summarize the findings of the linear regression analysis with a scatterplot including the regression line, regression equation and $r^2$.


```{r}

ggplot(nelson, aes(HUMIDITY, WEIGHTLOSS))+
  geom_point() +
  labs(x = "% Relative humidity", y = "Weight loss (mg)") +
  # geom_abline(intercept = nelson.lm$coefficients[1], slope = nelson.lm$coefficients[2], colour = "red") +
  geom_smooth(method = "lm", se = 0.95, lty = 2) +
  annotate("text", x= 99, y= 8.6, label = "WEIGHTLOSS == -0.053*HUMIDITY + 8.704", parse = T, hjust = 1) +
  annotate("text", x= 99, y= 9, label = "r^{2}==0.975", parse = T,hjust = 1) 

```

