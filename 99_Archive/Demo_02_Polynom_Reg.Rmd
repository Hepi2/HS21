```{r, include=F, purl = F}
# knitr::opts_knit$set(root.dir = "14_Statistik2") 
```



```{r, message=F}


library(tidyverse)
library(ggfortify) # um autoplot() für lm/aov nutzen zu können

```


Aus @logan2010 [S. 244]: Script an Tools/Packages des Moduls Research Methods angepasst

Sokal and Rohlf (1997) present an unpublished data set (R. K. Koehn) in which the nature of the relationship between Lap94 allele frequency in Mytilus edulis and distance (in miles) from Southport was investigated (Box 16.5, Sokal and Rohlf (1997)).


#### Step 1

Import the mytilus data set [myytilus.csv](14_Statistik2/data/mytilus.csv)

```{r, message = F}
mytilus <- read_csv("14_Statistik2/data/mytilus.csv")
```


As a matter of course, Sokal and Rohlf (1997) transform frequencies using angular transformations (arcsin transformations) and henceforth $Lap^{94}$ will be transformed in-line using $asin(\sqrt{LAP})*\frac{180}{\pi}$.

#### Step 2

Confirm that simple linear regression does not adequately describe the relationship between $Lap^{94}$ allele frequency and distance by examining a scatterplot and residual plot.

```{r}
ggplot(mytilus, aes(DIST,asin(sqrt(LAP))*180/pi))+
  geom_point() +
  geom_smooth(se = F, colour = "black") +
  geom_smooth(method = "lm", se = F, lty = 2, colour = "black")
```



```{r}
autoplot(lm(asin(sqrt(LAP))*180/pi~DIST, data=mytilus),which = 1)
```

Conclusions - the scatterplot smoother suggests a potentially non-linear relationship and a persisting pattern in the residuals further suggests that the linear model is inadequate for explaining the response variable.



#### Step 3

Fit a polynomial regression (additive multiple regression) model incorporating up to the fifth power (5$^{th}$ order polynomial).

Note that trends beyond a third order polynomial are unlikely to have much biological basis and are likely to be over-fit.

##### Fit the quintic model
```{r, fig.cap="Conclusions - no 'wedge' pattern suggesting that homogeneity of variance and there is no persisting pattern suggesting that the fitted model is appropriate for modeling these data."}
mytilus.lm5 <- lm(asin(sqrt(LAP)) * 180/pi ~ DIST + I(DIST^2)+I(DIST^3)+I(DIST^4)+I(DIST^5), mytilus)

```

##### Examine the diagnostics


```{r}
plot(mytilus.lm5, which = 1)


autoplot(mytilus.lm5, label.size = 3)

```

##### Examine the fit of the model including the contribution of different powers

```{r}
anova(mytilus.lm5)
```

Conclusions: powers of distance beyond a cubic (3) do notmake significant contributions to explaining the variation in arcsin transformed $Lat^{94}$ allele frequency.

##### The improved fit (and significance) attributed to an additional power can be evaluated by comparing the fit of the higher order models against models one lower in order.

```{r}
mytilus.lm1 <- lm(asin(sqrt(LAP)) * 180/pi ~ DIST, mytilus)
mytilus.lm2 <- lm(asin(sqrt(LAP)) * 180/pi ~ DIST + I(DIST^2),mytilus)

anova(mytilus.lm2, mytilus.lm1)



mytilus.lm3 <- lm(asin(sqrt(LAP)) * 180/pi ~ DIST + I(DIST^2)+I(DIST^3), mytilus)
anova(mytilus.lm3, mytilus.lm2)
```
Conclusions - a cubic model fits the data significantly better than a quadratic model (P = 0.018), the latter of which does not fit significantly better than a linear model (P = 0.09).

Due to the extreme multicollinearity problems (dist must be correlated to dist2 and dist3 etc), the parameter estimates are not stable, the standard errors are inflated and the individual parameter hypothesis tests are non informative. As with multiplicative multiple regression, this problem can be greatly alleviated by first centering the predictor variable. However, the value in doing so is limited as the resulting parameters (and associated confidence intervals) would then have to be back transformed into the original scales in order to construct a descriptive or predictive model (main uses of polynomial regression). Since the values of the estimated polynomial parameters do not have any biological meaning, standard errors and hypothesis tests of the parameter estimates should be ignored.


##### Estimate the model parametersm for the cubic model so as to establish the descriptive or predictive model.

```{r}
summary(mytilus.lm3)
```


Conclusions - there was a significant cubic relationship between the frequency of the $Lat^{94}$ allele in Mytilus edulis and distance from Southport (P < 0.001, $r^2 = 0.911$: $arcsin\sqrt{Lat} = 26.2233 - 0.9441dist + 0.0421dist^2 - 0.0003dist^3$).




#### Step 4

Construct a summary figure to summarize the illustrate the proposed nature of the relationship.

```{r}
ggplot(mytilus, aes(DIST,asin(sqrt(LAP))*180/pi))+
  geom_point() +
  geom_smooth(se = F, colour = "black") +
  labs(y = expression(paste("Arcsin ",sqrt(paste("freq. of allele ", italic("Lap"))^{94}))), x = expression(paste("Miles east of Southport,Connecticut")))
```
