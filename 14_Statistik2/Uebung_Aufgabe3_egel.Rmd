---
title: "Übungen Statistik"
author: "Gian-Andrea Egeler"
date: "13 9 2018"
output: html_document
---

### Erläuterungen zum Datensatz

Folgende Variablen sind im Datensatz beinhaltet:


|   Name der Variable	|   Beschreibung der Variable	|   
|---	|---	|
|   "transaction_id" |  Durch das Kassensystem generierte Identifikationsnummer	| 
|   "date"	|   Datum	|
|  "week" | Kalenderwoche |
|  "year" | Kalenderjahr  |
|  "meal_name" | Beschreibung der angebotenen Mahlzeit  |
|  "article_description" | Beschreibung der Men?-Linie (Favorite, Hot and Cold Buffet, Kitchen, Locals<sup>1</sup>, World)  |
|  "label_content" | Beschreibung des Menü-Inhalts (Fleisch<sup>2</sup>, Hot and Cold, Vegan<sup>3</sup>, Vegetarisch<sup>4</sup>)  |
|  "condit" | Beschreibung der Experimentalwochen (Basis- und Interventionswochen)  |
|  "card_num" | anonymisierte Kartennummer  |
|  "gender" | Geschlecht (F,M)  |
|  "member" | Hochschulzugehörigkeit (Studierdne, Mitarbeitende, "Lernende", "Spezialkarten")  |
|  "age" |  Alter in Jahren |
|  "price_acticle" |  Preis des gekauften Artikels |
|  "total_amount_pay" | Total bezahlter Betrag  |
|  "pay_description" | Bezahlungsart (Cash oder Badge (Debit))  |
|  "shop_description" | Ort der Mensa (Grüental oder Vista)  |
|  "tot_ubp" | Umweltbelastungspunkte pro Menü  |
|  "buffet_anmial" | Anzahl fleischhaltiger Produkte auf dem Hot and Cold Buffet |

--------

**Bemerkungen:**

1. Locals (Local Favorite, Local Kitchen, Local World) sind nebst den drei "normalen Menü-Linien" zusätzlich angebotene Menüs
2. hier werden Menüs mit Fisch, Geflügel als Fleisch zusammengefasst
3. Vegan sind ausschliesslich pflanzliche Menüs. Im Exeriment wurde zwischen pflanzlich substituierten und authentisch eigenständige Menüs unterschieden
4. Vegetarisch sind ovo-lakto-vegetarische Menüs


<br><br>

### Aufgabe 3: ANOVA

Führt mit dem Datensatz novanimal.csv eine ANOVA durch (Aufbereitung der Daten, visuelle Inspektion der Modellvoraussetzung, Berechnung des Modells, Darstellung und Interpretation der Ergebnisse). 
Gibt es Unterschiede zwischen den verkauften Menü-Inahlten (Fleisch oder Fisch, Hot and Cold Buffet und Vegetarisch)? Wie können die Unterschiede erklärt werden?

Ihre Gesamtaufgabe ist es, aus den Daten ein adäquates Modell zu ermitteln. 

**Abzugeben sind am Ende (a) Ein lauffähiges R-Skript; (b) begründeter Lösungsweg (Kombination aus R-Code, R Output und dessen Interpretation) und (c) ausformulierter Methoden- und Ergebnisteil (für eine wiss. Arbeit).**

Hinweise für die Analysen: 
* Menü-Inhalt wird zu drei Inhalten redimensioniert (Pflanzliche = Vegetarische Menüs)
* Der Datensatz soll zuerst Gruppiert werden (Wochen, Menü-Inhalt und Beschreibung der Experimentalwochen)


### Musterlösung Aufgabe 3

```{r, message=FALSE, echo=FALSE, results='hide', warning=FALSE}

library(readr)
library(dplyr)
library(car)
library(gmodels)
library(ggfortify)

nova <- read_delim("/home/egel/Unterrichtsunterlagen_HS18/13_Statistik1/data/novanimal.csv", delim = ";")

```


```{r, fig.width=20, fig.height=12 }
# gruppiere Daten zuerst

df <- nova # mache eine Kopie vom original Datensatz
df$label_content[grep("Pflanzlich+",df$label_content)] <- "Vegetarisch" # Fasse die Menü-Inhalte zusammen

# df_ <- df %>%
#     group_by(condit, label_content, week) %>%
#     summarise(tot_sold = n()) %>%
#     na.omit() # lasse die unbekannten Verkäufe weg

# neue Gruppierung, scheint besser zu sein, erzeugt mehr varianz
df_ <- df %>%
    group_by(condit, label_content, week, gender, member) %>%
    summarise(tot_sold = n()) %>%
    na.omit() # lasse die unbekannten Verkäufe weg
    

# Unterscheiden sich die Verkaufszahlen pro Menü-Inhalt? 
model <- aov(tot_sold ~ label_content, data = df_)
ggplot(df_, aes(x = tot_sold, y = ..count..)) + geom_histogram() # schaue die Verkaufszahlen in einem Histogramm an
autoplot(model) # Inspektion der Modellvoraussetzung: Daten sollten für eine ANOVA passen
summary.lm(model)

# Visualisierung und Dasrtellung der Ergebnisse 
ggplot(df_, aes(x = label_content, y= na.omit(tot_sold))) + geom_boxplot(fill="lightgrey") + labs(x = "Menu-Inhalt", y = "verkaufte Menus")


# Soziodemografische Unterschiede in der Menü-Wahl? Alter kann als alternative hinzugenommen werden (nur als altersgruppen).
model1 <- aov(tot_sold ~ label_content + gender + member, data = df_)
autoplot(model1)  # Inspektion der Modellvoraussetzung
summary.lm(model1) # Was ist das spannendste Ergebnis?

# Experimentalwochen als Erklärung für die Verkaufszahlen?
model2 <- aov(tot_sold ~ label_content + condit + gender + member, data = df_) # Achtung Interaktionseffekte, Haupteffekte können nicht mehr interpretiert werden
autoplot(model2)  # Inspektion der Modellvoraussetzung
summary.lm(model2) # Was ist das spannendste Ergebnis?


# Nehme passendes Modell und visualisiere dieses
ggplot(df, aes(x = interaction(label_content, condit), y = tot_sold)) + geom_boxplot(fill="lightgrey") + labs(x = "Menu-Inhalt", y = "verkaufte Menus")

```



