---
output:
  html_document: default
  pdf_document: default
---

## Musterlösung Aufgabe 2.3N: Mehrfaktorielle ANOVA

**Übungsaufgabe (hier so ausführlich formuliert, wie dies auch in der Klausur der Fall sein
wird)**

- Laden Sie den Datensatz kormoran.txt mit read.table. Dieser enthält Tauchzeiten
(hier ohne Einheit) von Kormoranen in Abhängigkeit von Jahreszeit und Unterart.
Unterarten: Phalacrocorax carbo carbo (C) und Phalacrocorax carbo sinensis (S);
Jahreszeiten: F = Frühling, S = Sommer, H = Herbst, W = Winter.
- **Ihre Gesamtaufgabe ist es, aus diesen Daten ein minimal adäquates Modell zu
ermitteln, das diese Abhängigkeit beschreibt.**
- Bitte erklären und begründen Sie die einzelnen Schritte, die Sie unternehmen, um zu
diesem Ergebnis zu kommen. Dazu erstellen Sie bitte ein Word-Dokument, in das Sie
Schritt für Schritt den verwendeten R-Code, die dazu gehörigen Ausgaben von R, Ihre
Interpretation derselben und die sich ergebenden Schlussfolgerungen für das weitere
Vorgehen dokumentieren.
- Dieser Ablauf sollte insbesondere beinhalten:
  - Überprüfen der Datenstruktur nach dem Einlesen, welches sind die abhängige(n)
    und welches die unabängige(n) Variablen, welches statistische Verfahren wenden Sie
    an?
  - Explorative Datenanalyse, um zu sehen, ob schon vor dem Start der Analysen
    Transformationen o.ä. vorgenommen werden sollten
  - Definition eines vollen Modelles, das nach statistischen Kritierien zum minimal
    adäquaten Modell reduziert wird
  - Durchführen der Modelldiagnostik, um zu entscheiden, ob das gewählte Vorgehen
    korrekt war oder ggf. angepasst werden muss
  - Generieren aller Zahlen, Statistiken und Tabellen, die für eine wiss.
    Ergebnisdarstellung benötigt werden
- Formulieren Sie abschliessend einen Methoden- und Ergebnisteil (ggf. incl.
  adäquaten Abbildungen) zu dieser Untersuchung in der Form einer
  wissenschaftlichen Arbeit (ausformulierte schriftliche Zusammenfassung, mit je
  einem Absatz von ca. 60-100 Worten, resp. 3-8 Sätzen für den Methoden- und
  Ergebnisteil). D. h. alle wichtigen Informationen sollten enthalten sein, unnötige
  Redundanz dagegen vermieden werden.
- **Abzugeben sind am Ende (a) Ein lauffähiges R-Skript; (b) begründeter Lösungsweg
  (Kombination aus R-Code, R Output und dessen Interpretation) und (c)
  ausformulierter Methoden- und Ergebnisteil (für eine wiss. Arbeit).**


```{r, include=FALSE, purl=F}

knitr::opts_chunk$set(echo = TRUE, include = T, results = "show",collapse=TRUE)
```

**Loesung -- Skript**

**Uebung 2.3N - Mehrfaktorielle ANOVA**

```{r}

kormoran <-read.delim("14_Statistik2/data/kormoran.csv",sep = ";")

## Ueberpruefen, ob Einlesen richtig funktioniert hat und welche Datenstruktur vorliegt
str(kormoran)
summary(kormoran)

#Um die Variablen im Dataframe im Folgenden direkt (ohne $ bzw. ohne "data = kormoran") ansprechen zu koennen
attach(kormoran)

#Umsortieren der Faktoren, damit sie in den Boxplots eine sinnvolle Reihung haben
Jahreszeit<-factor(Jahreszeit,levels=c("F","S","H","W"))

#Explorative Datenanalyse (zeigt uns die Gesamtverteilung)
boxplot(Tauchzeit)
boxplot(log10(Tauchzeit))

#Explorative Datenanalyse (Check auf Normalverteilung der Residuen und Varianzhomogenitaet)
boxplot(Tauchzeit~Jahreszeit*Unterart)
boxplot(log10(Tauchzeit)~Jahreszeit*Unterart)

#Vollständiges Modell mit Interaktion
model <- aov(Tauchzeit~Unterart*Jahreszeit)
model
summary(model)
#p-Wert der Interaktion ist 0.266

#Modellvereinfachung
model2 <- aov(Tauchzeit~Unterart+Jahreszeit)
model2
summary(model2)

#Anderer Weg, um zu pruefen, ob man das komplexere Modell mit Interaktion behalten soll
anova(model,model2)
#in diesem Fall bekommen wir den gleichen p-Wert wie oben (0.266)

#Modelldiagnostik
par(mfrow=c(2,2)) #alle vier Abbildungen in einem 2 x 2 Raster
plot(model2)
influence.measures(model2) # kann man sich zusaezlich zum "plot" ansehen, um herauszufinden, ob es evtl. sehr einflussreiche Werte mit Cook's D von 1 oder grösser gibt

#Alternative mit log10
model3 <-aov(log10(Tauchzeit)~Unterart+Jahreszeit)
model3
summary(model3)
plot(model3)

#Ergebnisdarstellung
par(mfrow=c(1,1)) #Zurückschalten auf Einzelplots
library(multcomp)

letters<-cld(glht(model2,linfct=mcp(Unterart="Tukey")))
boxplot(Tauchzeit~Unterart,xlab="Unterart",ylab="Tauchzeit")
mtext(letters$mcletters$Letters,at=1:2)
#genaugenommen braucht man bei nur zwei Kategorien keinen post hoc-Test

letters<-cld(glht(model2,linfct=mcp(Jahreszeit="Tukey")))
boxplot(Tauchzeit~Jahreszeit,xlab="Jahreszeit",ylab="Tauchzeit") #Achsenbeschriftung nicht vergessen!
mtext(letters$mcletters$Letters,at=c(1:4))

#Jetzt brauchen wir noch die Mittelwerte bzw. Effektgroessen
summary(lm(Tauchzeit~Jahreszeit))
summary(lm(Tauchzeit~Unterart))

aggregate(kormoran[,1],list(Unterart),mean)
aggregate(kormoran[,1],list(Jahreszeit),mean)

```
