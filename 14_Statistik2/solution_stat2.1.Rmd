## Musterloesung Aufgabe 2.1: Regression

[RCode als Download](14_Statistik2/RFiles/Loesung_2.1_v.04.R)

**Übungsaufgabe (hier so ausführlich formuliert, wie dies auch in der Klausur der Fall sein
wird)**

- Laden Sie den Datensatz decay.csv. Dieser enthält die Zahl radioaktiver Zerfälle pro
Zeiteinheit (amount) für Zeitpunkte (time) nach dem Start des Experimentes.
- **Ermitteln Sie ein statistisches Modell, dass die Zerfallshäufigkeit in Abhängigkeit
von der Zeit beschreibt.**
- Bitte erklären und begründen Sie die einzelnen Schritte, die Sie unternehmen, um zu
diesem Ergebnis zu kommen. Dazu erstellen Sie bitte ein Word-Dokument, in das Sie
Schritt für Schritt den verwendeten R-Code, die dazu gehörigen Ausgaben von R, Ihre
Interpretation derselben und die sich ergebenden Schlussfolgerungen für das weitere
Vorgehen dokumentieren.
- Dieser Ablauf sollte insbesondere beinhalten:
    - Überprüfen der Datenstruktur nach dem Einlesen, welches sind die abhängige(n) und welches die             unabängige(n) Variablen
    - Explorative Datenanalyse, um zu sehen, ob evtl. Dateneingabefehler vorliegen oder
      Datentransformationen vorgenommen werden sollten
    - Auswahl und Begründung eines statistischen Verfahrens (es gibt hier mehrere
      statistisch korrekte Möglichkeiten!)
    - Ermittlung eines Modells
    - Durchführen der Modelldiagnostik für das gewählte Modell
    - Generieren aller Zahlen, Statistiken und Tabellen, die für eine wiss.
      Ergebnisdarstellung benötigt werden
    - Formulieren Sie abschliessend einen Methoden- und Ergebnisteil (ggf. incl.
      adäquaten Abbildungen) zu dieser Untersuchung in der Form einer
      wissenschaftlichen Arbeit (ausformulierte schriftliche Zusammenfassung, mit je
      einem Absatz von ca. 60-100 Worten, resp. 3-8 Sätzen für den Methoden- und
      Ergebnisteil). D. h. alle wichtigen Informationen sollten enthalten sein, unnötige
      Redundanz dagegen vermieden werden.
    - **Abzugeben sind am Ende (a) Ein lauffähiges R-Skript; (b) begründeter Lösungsweg
      (Kombination aus R-Code, R Output und dessen Interpretation) und (c)
      ausformulierter Methoden- und Ergebnisteil (für eine wiss. Arbeit).**
      

**Lösungsweg**

```{r}
SAR <- read.delim("14_Statistik2/data/SAR.csv",sep = ";")
SAR
```


**Explorative Datenanalyse**
```{r}
summary(SAR)
boxplot(SAR$area)
boxplot(SAR$richness)
plot(richness~area,data=SAR)
```



**Einfaches lineares Modell**
```{r}
lm.1 <- lm(richness~area, data=SAR)
summary(lm.1)
```
Das sieht erst (SAR$area, SAR$richness, xlab="Area [m²]", ylab="Species richness")
abline(lm(richness~area, data=SAR), col="red") #Alternative 1
abline(lm.1,col="red") #Alternative 2einmal nach einem Supermodell aus, höchstsignifikant und mit einem hohen R² von fast 77%. ABER: wir müssen uns noch die Modelldiagnostik ansehen...

**Modelldiagnostik**
```{r}
par(mfrow=c(2,2))
plot(lm.1)
```

**Ergebnisplot**
```{r}
par(mfrow=c(1,1))

plot(SAR$area, SAR$richness, xlab="Area [m²]", ylab="Species richness")
abline(lm(richness~area, data=SAR), col="red") #Alternative 1
abline(lm.1, col="red") #Alternative 2

plot
```


**Loesung 1: log-Transformation der abhaengigen Variablen**
```{r} 
par(mfrow=c(1,2))
boxplot(SAR$richness)
boxplot(log10(SAR$richness))
hist(SAR$richness)
hist(log10(SAR$richness))

SAR$log_richness<-log10(SAR$richness)
lm.2 <- lm(log_richness~area, data=SAR)
summary(lm.2)
```


```{r, eval = FALSE} 
lm.2 <- lm(log(amount)~time, data=decay)
summary(lm.2)
```


**Modelldiagnostik**
```{r}
par(mfrow=c(2,2))
plot(lm.2)
```

#sieht noch schlechter aus


**Lösung B: log-Transformation beider Variablen**

```{r}
par(mfrow=c(1,2))
boxplot(SAR$area)
boxplot(log10(SAR$area))
hist(SAR$area)
hist(log10(SAR$area))

SAR$log_area<-log10(SAR$area)
lm.3 <- lm(log_richness~log_area, data=SAR)
summary(lm.3)
```


**Modelldiagnostik**
```{r}
par(mfrow=c(2,2))
plot(lm.3)
```

das sieht jetzt sehr gut aus, bis auf zwei Ausreisser im QQ-Plot


**Lösung C **
kommt erst in Statistik 4; methodisch beste Lösung; mit Startwerten muss man ggf. ausprobieren)

```{r}
model.nls<-nls(richness~a*area^b, start=(list(a=100,b=1)), data=SAR)
summary(model.nls)
```


**Modelldiagnostik**
```{r, eval = FALSE}
model.nls <- nls(amount~a*exp(-b*time), start=(list(a=100,b=1)),data=decay)
summary(model.nls)
```

**Modelldiagnostik**
```{r}
if(!require(nlstools)){install.packages("nlstools")}
library(nlstools)

residuals.nls <- nlsResiduals(model.nls)
plot(residuals.nls)
```
**Ergebnisplots**
```{r}
par(mfrow=c(1,1))
xv <- seq(0,100,0.1)
```

A. lineares Modell mit log-transformierter Abhaengiger
```{r}
plot(SAR$area,SAR$richness)
yv1a <- 10^predict(lm.2,list(area=xv))
lines(xv, yv1a, col="red")
```

B. lineares Modell mit log-Transformation beider Variablen
```{r}
plot(SAR$area, SAR$richness)
yv1b <- predict(lm.3, list(log_area=xv))
lines(10^xv, 10^yv1b, col="green")
```


# Modelle im Vergleich
```{r}
plot(SAR$area,SAR$richness)
abline(lm.1,col="red")
lines(xv, yv1a, col="blue")
lines(10^xv, 10^yv1b, col="green")
```

